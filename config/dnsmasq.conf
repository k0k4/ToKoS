# /etc/dnsmasq.conf
# Tor Security Router - DHCP and DNS Configuration

# ---- Global Settings ----
# Do not read /etc/resolv.conf for upstream DNS (we control it)
no-resolv

# Listen on localhost + LAN interfaces (never on WAN)
listen-address=127.0.0.1
listen-address=192.168.10.1
listen-address=192.168.20.1
listen-address=192.168.30.1

# DHCP needs interface names
interface=eth1
interface=eth2
interface=eth3

# Bind specifically to these addresses
bind-interfaces

# DNS upstream for eth1 (LAN Padrão) -> Pi-hole on localhost
# Pi-hole listens on 192.168.10.1:53 after it is installed.
# Before Pi-hole: use a safe public DoH resolver proxy.
server=192.168.10.1#5335

# No DNS for eth2/eth3 (Tor handles DNS via DNSPort - iptables redirects)
# dnsmasq assigns DNS=gateway IP for those networks so clients have a valid
# resolver entry, but iptables will transparently redirect port 53 to Tor's
# DNSPort (9053) before the packet leaves the router.

# ---- Security Settings ----
domain-needed          # Never forward plain names
bogus-priv             # Never forward reverse lookups for private IPs
dnssec                 # Enable DNSSEC validation

# ---- LAN Padrão (eth1): 192.168.10.0/24 ----
dhcp-range=eth1,192.168.10.50,192.168.10.150,255.255.255.0,12h
dhcp-option=eth1,3,192.168.10.1       # Gateway
dhcp-option=eth1,6,192.168.10.1       # DNS server -> Pi-hole
dhcp-option=eth1,15,lan.local         # Domain

# ---- LAN Tor 1 (eth2): 192.168.20.0/24 ----
dhcp-range=eth2,192.168.20.50,192.168.20.150,255.255.255.0,12h
dhcp-option=eth2,3,192.168.20.1
dhcp-option=eth2,6,192.168.20.1       # DNS -> iptables will redirect to Tor

# ---- LAN Tor 2 (eth3): 192.168.30.0/24 ----
dhcp-range=eth3,192.168.30.50,192.168.30.150,255.255.255.0,12h
dhcp-option=eth3,3,192.168.30.1
dhcp-option=eth3,6,192.168.30.1       # DNS -> iptables will redirect to Tor

# ---- Lease Database ----
dhcp-leasefile=/var/lib/misc/dnsmasq.leases

# ---- Logging (optional, comment out in production) ----
# log-queries
# log-dhcp
log-facility=/var/log/dnsmasq.log
